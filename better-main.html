<!DOCTYPE html>
<html>
<body>
    <script>
        var canUploadFile = false;
        var hasUploadPresentationName = false;
        var hasUploadPresentationFile = false;

        function getPresentationsRequest() {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "presentations-list.php");
            xhr.onload = function () {
                var data = JSON.parse(this.response);
                console.log(data);

                document.getElementById("presentations-list").innerHTML = "";

                var list = document.createElement("ul");
                for (let presentationData of data) {
                    var presentationElement = document.createElement("li");
                    
                    var innerLink = document.createElement("a");
                    innerLink.setAttribute("href", "better-editor.html?presentation=" + presentationData);
                    innerLink.text = presentationData;

                    presentationElement.append(innerLink);
                    
                    list.appendChild(presentationElement);
                }
                document.getElementById("presentations-list").append(list);
            }
            xhr.send();
        }

        function uploadPresentationRequest() {
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "upload-presentation.php");

            let formData = new FormData();
            formData.append("file", document.getElementById("presentationFile").files[0]);
            formData.append("presentationName", document.getElementById("presentationName").value);

            document.getElementById("presentationName").value = "";
            document.getElementById("presentationFile").value = "";
            canUploadFile = false;
            hasUploadPresentationName = false;
            hasUploadPresentationFile = false;
            refreshButtons();

            xhr.onload = function () {
                var data = JSON.parse(this.response);
                console.log(data);
                getPresentationsRequest();
            }
            xhr.send(formData);
        }

        function refreshButtons() {
            if (!canUploadFile) {
                document.getElementById("upload-presentation").setAttribute("disabled", "true");
            } else {
                document.getElementById("upload-presentation").removeAttribute("disabled");
            }
        }

        function checkIfCanUploadFiles() {
            hasUploadPresentationFile = document.getElementById("presentationFile").value.length; 
            hasUploadPresentationName = document.getElementById("presentationName").value.length; 
            canUploadFile = hasUploadPresentationName && hasUploadPresentationFile;
            refreshButtons();
        }

        function init() {
            document.getElementById("upload-presentation").onclick = uploadPresentationRequest;
            document.getElementById("presentationFile").oninput = checkIfCanUploadFiles;
            document.getElementById("presentationName").oninput = checkIfCanUploadFiles;
            
            getPresentationsRequest();
            refreshButtons();
        }
        window.onload = init;
    </script>

    <div id="presentations-list"></div> 

    <div>
        <input type="file" id="presentationFile" name="presentationFile">
        <input type="text" id="presentationName" name="presentationName">
        <button id="upload-presentation" type="submit">Upload</button>    
    </div>

</body>
</html>
